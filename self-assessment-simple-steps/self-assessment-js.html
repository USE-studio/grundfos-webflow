<!-- This script lets us use any component for our arrows. This way we can position freely -->
<script>
  var Webflow = Webflow || [];
  var l = $('#flowbaseSlider .w-slider-arrow-left');
  var r = $('#flowbaseSlider .w-slider-arrow-right');
  let stepValue = 0;
  
  // Define Datalayer
  console.log('reading this far');
  window.dataLayer = window.dataLayer || [];
  // Start by pushing some initial data layer stuff
  window.dataLayer.push({
    'which-flow': 'self-assessment-basic'
  });
  let thePieProgressWrapper = document.querySelector('.pieprogresswrapper')
  let thePieProgress = document.querySelector('.pieprogress')
  
  // ***************************************
  // cooling towers or not - start variables
  let doesHaveCoolingTowers = true;
  // The radio button for having cooling towers
  let hasCoolingTowers = document.querySelector('#hasCoolingTowers')
  // The radio button for no cooling towers
  let noCoolingTowers = document.querySelector('#noCoolingTowers')
  // ***************************************
  // cooling towers or not - end variables
  
  
  // ***************************************
  // No. of Chillers input - start variables
  let numberOfChillersInput = document.getElementById('Number-of-chillers');
  // ***************************************
  // No. of Chillers input - end variables


  // The newsletter button
  let HiddenLinkToNewsletter = document.querySelector('.hiddenlinktonewsletter')
  // The energy saving button
  let energySavingReportSubmitBtn = document.getElementById('energySavingReportSubmitBtn')


  // ***********************************
  // For adding inputs - start variables
  // ***********************************
  let btnAddInputChiller = document.getElementById('btnAddInputChiller')
  // formWrapToBeCloned
  let formWrapToBeCloned = document.getElementById('formWrapToBeCloned')
  // formContentToBeAddedTo
  // let formContentToBeAddedTo = document.getElementById('formContentToBeAddedTo')
  let formWrapContainerThatHostsClones = document.getElementById('formWrapContainerThatHostsClones')
  // input amount / chiller amount
  let chillerAmount = 1;
  // ***********************************
  // For adding inputs - end variables
  // ***********************************


  // Get all radio button
  // let allinputs = document.getElementsByClassName('has-input-power-to-enable')
  let allinputs = document.querySelectorAll('[has-input-power-to-enable]')
  for (let i = 0; i < allinputs.length; i++) {
    console.log(allinputs[i])
    allinputs[i].addEventListener('click', (e) => {
      thePieProgressWrapper.classList.remove('pieprogresswrapper--disabled');
    })
  }

  function disableProgressWrapper() {
    thePieProgressWrapper.classList.add('pieprogresswrapper--disabled');
  }

  // Start by disabling the progresswrapper
  disableProgressWrapper();

  // **************************************
  // Setup btnAddInputChiller logic - start
  // **************************************
  function addChiller() {
    console.log('cloning formwrap')
    // Increase the chiller value;
    chillerAmount++;
    // Copy the form-wrap w/ input element and its child nodes
    var clonedFormWrap = formWrapToBeCloned.cloneNode(true);
    // Get the input child of the one just cloned
    var theNewBornInput = clonedFormWrap.getElementsByTagName('input')[0]
    // Set the attributes of this new input
    theNewBornInput.setAttribute('name', `Chiller-${chillerAmount}-kW`)
    theNewBornInput.setAttribute('data-name', `Chiller ${chillerAmount} kW`)
    theNewBornInput.setAttribute('id', `Chiller-${chillerAmount}-kW`)
    // Append the cloned <li> element to <ul> with id="myList1"
    formWrapContainerThatHostsClones.appendChild(clonedFormWrap);
  }

  btnAddInputChiller.addEventListener('click', () => {
    addChiller();
  })
  // ************************************
  // Setup btnAddInputChiller logic - end
  // ************************************

  Webflow.push(function () {
    
    // Check where we are in the progress of self-ass. steps
    function checkProgress() {
      console.log('checkProgress stepValue; ', stepValue)
      // alert('heya')
      if (stepValue == 0) {
        console.log('is 0')
      }
      if (stepValue == 1 && stepValue < 2) {
        console.log('is 1')
        console.log(document.querySelector('.pieprogress'))
        // alert('it should be visible now')
        thePieProgress.classList.add('pieprogress--revealed')
      }
      else if (stepValue == 2 && stepValue < 3) {
        console.log('is 2')
        thePieProgress.classList.add('step-one')
      }
      else if (stepValue == 3 && stepValue < 4) {
        console.log('is 3')
        thePieProgress.classList.add('step-two')
      }
      else if (stepValue == 4 && stepValue < 5) {
        thePieProgress.classList.add('step-three')
      }
      else if (stepValue == 5 && stepValue < 6) {
        thePieProgress.classList.add('step-four')
      }
    }

    // This is called whenever we need to progress one step
    // and increment the stepValue
    function moveForwardInSteps() {
      // Increment the step value
      stepValue++;
      console.log('this: ', this);
      // console.log('stepValue increase: ', stepValue);
      // Push stepValue to data layer
      window.dataLayer.push({
        'stepValue': stepValue
      });
      // Org. code
      r.trigger('tap');
      // Check the progress
      checkProgress();
    }

    // The flow slider parent
    $('#flowbaseSlider')
      .on('click', '.slider-left', function () {
        // Decrement the step value
        stepValue--;
        // console.log('stepValue decrease: ', stepValue);
        // Push stepValue to data layer
        window.dataLayer.push({
          'stepValue': stepValue
        });
        // Org. code
        l.trigger('tap');
        // Check the progress
        checkProgress();
      })
      // The progress button
      .on('click', '.pieprogresswrapper', function () {
        // Now disable the progresswrapper again until there is an input
        disableProgressWrapper();
        // Is it relevant at all?
        if (!doesHaveCoolingTowers) {
          console.log('Oh, we\'re sorry')
          HiddenLinkToNewsletter.click()
          return;
        }
        // If current step is about number of Chillers
        if (stepValue == 3) {
          // Save data to sessionStorage
          let numberOfChillersValue = numberOfChillersInput.value !== '' ? parseInt(numberOfChillersInput.value) : 0;
          console.log('session storage - set');
          sessionStorage.setItem('noOfChillersValue', numberOfChillersValue);
        }
        // If current step is after number of Chillers
        if (stepValue == 4) {
          // Get saved data from sessionStorage
          let sData = sessionStorage.getItem('noOfChillersValue');
          console.log('session storage - get');
          console.log('Number of chillers', sData);
        }
        // If current step is send energy savings report
        if (stepValue == 5) {
          console.log('getting in alright')
          energySavingReportSubmitBtn.click()
          return;
          // Wait til the submit has done its thing. Should be callback
          // setTimeout(() => {
          //   // Increment the step value
          //   // moveForwardInSteps();
          // }, 5000)
        }
        moveForwardInSteps();
      })
      // The normal button
      .on('click', '.slider-right', function () {
        moveForwardInSteps();
      });

    // When the hasCoolingTowers radio is clicked
    hasCoolingTowers.addEventListener('change', (e) => {
      doesHaveCoolingTowers = true
    })
    // When the noCoolingTowers radio is clicked
    noCoolingTowers.addEventListener('change', (e) => {
      doesHaveCoolingTowers = false
    })
  });

  //
</script>

<!-- Here you can change to date slider and manage attributes about it -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.1.2/js/ion.rangeSlider.min.js"></script>
<script>
  $("#range_price").ionRangeSlider({
    grid: true,
    min: 3000,
    max: 10000,
    from: 2500,
    prefix: "", // org. $
    postfix: " sq ft",
    hide_min_max: true,
    decorate_both: true,
    force_edges: true,
    step: 50
  });
  $("#range_date").ionRangeSlider({
    grid: true,
    min: 0,
    max: 12,
    from_min: 0.5,
    from: 1,
    prefix: "M",
    postfix: " month(s)",
    hide_min_max: true,
    force_edges: true,
    step: 0.5
  });
</script>