<!-- This script lets us use any component for our arrows. This way we can position freely -->
<script>
  var Webflow = Webflow || [];
  var l = $('#flowbaseSlider .w-slider-arrow-left');
  var r = $('#flowbaseSlider .w-slider-arrow-right');
  let stepValue = 0;
  let hasNoCoolingTowers = true
  // Define Datalayer
  console.log('reading this far');
  window.dataLayer = window.dataLayer || [];
  // Start by pushing some initial data layer stuff
  window.dataLayer.push({
    'which-flow': 'self-assessment-basic'
  });
  let thePieProgressWrapper = document.querySelector('.pieprogresswrapper')
  let thePieProgress = document.querySelector('.pieprogress')
  // The radio button for no cooling towers
  let noCoolingTowers = document.querySelector('#noCoolingTowers')
  // The newsletter button
  let HiddenLinkToNewsletter = document.querySelector('.hiddenlinktonewsletter')
  // The energy saving button
  let energySavingReportSubmitBtn = document.getElementById('energySavingReportSubmitBtn')

  // Get all radio button
  // let allinputs = document.getElementsByClassName('has-input-power-to-enable')
  let allinputs = document.querySelectorAll('[has-input-power-to-enable]')
  for (let i = 0; i < allinputs.length; i++) {
    console.log(allinputs[i])
    allinputs[i].addEventListener('click', (e) => {
      thePieProgressWrapper.classList.remove('pieprogresswrapper--disabled');
    })
  }

  function disableProgressWrapper() {
    thePieProgressWrapper.classList.add('pieprogresswrapper--disabled');
  }

  // Start by disabling the progresswrapper
  disableProgressWrapper();

  Webflow.push(function () {
    
    // Check where we are in the progress of self-ass. steps
    function checkProgress() {
      console.log('checkProgress stepValue; ', stepValue)
      // alert('heya')
      if (stepValue == 0) {
        console.log('is 0')
      }
      if (stepValue == 1 && stepValue < 2) {
        console.log('is 1')
        console.log(document.querySelector('.pieprogress'))
        // alert('it should be visible now')
        thePieProgress.classList.add('pieprogress--revealed')
      }
      else if (stepValue == 2 && stepValue < 3) {
        console.log('is 2')
        thePieProgress.classList.add('step-one')
      }
      else if (stepValue == 3 && stepValue < 4) {
        console.log('is 3')
        thePieProgress.classList.add('step-two')
      }
      else if (stepValue == 4 && stepValue < 5) {
        thePieProgress.classList.add('step-three')
      }
      else if (stepValue == 5 && stepValue < 6) {
        thePieProgress.classList.add('step-four')
      }
    }

    // This is called whenever we need to progress one step
    // and increment the stepValue
    function moveForwardInSteps() {
      // Increment the step value
      stepValue++;
      console.log('this: ', this);
      // console.log('stepValue increase: ', stepValue);
      // Push stepValue to data layer
      window.dataLayer.push({
        'stepValue': stepValue
      });
      // Org. code
      r.trigger('tap');
      // Check the progress
      checkProgress();
    }

    // The flow slider parent
    $('#flowbaseSlider')
      .on('click', '.slider-left', function () {
        // Decrement the step value
        stepValue--;
        // console.log('stepValue decrease: ', stepValue);
        // Push stepValue to data layer
        window.dataLayer.push({
          'stepValue': stepValue
        });
        // Org. code
        l.trigger('tap');
        // Check the progress
        checkProgress();
      })
      // The progress button
      .on('click', '.pieprogresswrapper', function () {
        // Now disable the progresswrapper again until there is an input
        disableProgressWrapper();
        // Is it relevant at all?
        if (!hasNoCoolingTowers) {
          console.log('Oh, we\'re sorry')
          HiddenLinkToNewsletter.click()
          return;
        }
        // If current step is send energy savings report
        if (stepValue == 5) {
          console.log('getting in alright')
          energySavingReportSubmitBtn.click()
          return;
          // Wait til the submit has done its thing. Should be callback
          // setTimeout(() => {
          //   // Increment the step value
          //   // moveForwardInSteps();
          // }, 5000)
        }
        moveForwardInSteps();
      })
      // The normal button
      .on('click', '.slider-right', function () {
        moveForwardInSteps();
      });

    // When the noCoolingTowers radio is clicked
    noCoolingTowers.addEventListener('change', (e) => {
      console.log('i am changed')
      var target = e.target || e.srcElement
      console.log(target)
      hasNoCoolingTowers = false
    })
  });
</script>

<!-- Here you can change to date slider and manage attributes about it -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ion-rangeslider/2.1.2/js/ion.rangeSlider.min.js"></script>
<script>
  $("#range_price").ionRangeSlider({
    grid: true,
    min: 3000,
    max: 10000,
    from: 2500,
    prefix: "", // org. $
    postfix: " sq ft",
    hide_min_max: true,
    decorate_both: true,
    force_edges: true,
    step: 50
  });
  $("#range_date").ionRangeSlider({
    grid: true,
    min: 0,
    max: 12,
    from_min: 0.5,
    from: 1,
    prefix: "M",
    postfix: " month(s)",
    hide_min_max: true,
    force_edges: true,
    step: 0.5
  });
</script>